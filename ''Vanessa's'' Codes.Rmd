```{r}
library(tidyverse)
library(lubridate)

# Set your directory path
file_list <- list.files(path = "OpalPatronage", pattern = "*.txt", full.names = TRUE)


# Read and combine all files
all_data <- file_list %>%
  map_dfr(~ read_delim(.x, delim = "|", col_types = cols(.default = "c")))

# Filter for 'All - NSW' region
nsw_data <- all_data %>%
  filter(ti_region == "All - NSW") %>%
  mutate(
    trip_origin_date = as.Date(trip_origin_date),
    Tap_Ons = as.numeric(str_replace(Tap_Ons, "<", "0")),
    Tap_Offs = as.numeric(str_replace(Tap_Offs, "<", "0"))
  )


# Summarize by date and mode
daily_mode_summary <- nsw_data %>%
  group_by(trip_origin_date, mode_name) %>%
  summarise(Total_Tap_Ons = sum(Tap_Ons, na.rm = TRUE), .groups = "drop")

# Add 'All' mode
daily_all <- daily_mode_summary %>%
  group_by(trip_origin_date) %>%
  summarise(mode_name = "All", Total_Tap_Ons = sum(Total_Tap_Ons), .groups = "drop")

# Combine
final_data <- bind_rows(daily_mode_summary, daily_all)

# Plot
ggplot(final_data, aes(x = trip_origin_date, y = Total_Tap_Ons, color = mode_name)) +
  geom_line() +
  labs(title = "Transport Usage Over Time (All - NSW)",
       x = "Date", y = "Tap Ons", color = "Mode") +
 theme_minimal()
```

